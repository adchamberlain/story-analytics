version: 2

saved_queries:
  - name: monthly_revenue_overview
    label: Monthly Revenue Overview
    description: |
      Key revenue and volume metrics by month. Shows total revenue, GMV, order count,
      and average order value trends over time.
    query_params:
      metrics:
        - total_revenue
        - total_gmv
        - total_freight_revenue
        - order_count
        - average_order_value
        - items_per_order
      group_by:
        - "TimeDimension('metric_time', 'month')"
      order_by:
        - "TimeDimension('metric_time', 'month')"

  - name: daily_order_performance
    label: Daily Order Performance
    description: |
      Daily operational metrics including order volume, delivery rates, and
      customer satisfaction scores.
    query_params:
      metrics:
        - order_count
        - delivered_orders
        - delivery_rate
        - cancellation_rate
        - average_review_score
        - customer_satisfaction_rate
      group_by:
        - "TimeDimension('metric_time', 'day')"
      order_by:
        - "TimeDimension('metric_time', 'day') desc"

  - name: customer_state_analysis
    label: Customer State Analysis
    description: |
      Revenue and order metrics broken down by customer state. Identifies
      top-performing geographic markets.
    query_params:
      metrics:
        - total_revenue
        - order_count
        - unique_customers
        - average_order_value
        - delivery_rate
        - customer_satisfaction_rate
      group_by:
        - "Dimension('customers__customer_state')"
      order_by:
        - total_revenue desc

  - name: product_category_performance
    label: Product Category Performance
    description: |
      Sales performance by product category including revenue, units sold,
      and average pricing.
    query_params:
      metrics:
        - total_revenue
        - order_items
        - average_item_price
        - unique_products_sold
      group_by:
        - "Dimension('products__product_category_name')"
      where:
        - "{{ Dimension('products__product_category_name') }} is not null"
      order_by:
        - total_revenue desc

  - name: payment_method_breakdown
    label: Payment Method Breakdown
    description: |
      Analysis of payment methods used, including transaction counts, values,
      and installment usage.
    query_params:
      metrics:
        - payment_count
        - total_payment_value
        - average_payment_value
        - average_installments
      group_by:
        - "Dimension('order_payments__payment_type')"
      order_by:
        - payment_count desc

  - name: seller_performance_metrics
    label: Seller Performance Metrics
    description: |
      Top sellers by revenue, order volume, and customer satisfaction.
      Useful for identifying high-performing marketplace sellers.
    query_params:
      metrics:
        - total_revenue
        - order_count
        - order_items
        - average_review_score
      group_by:
        - "Entity('seller')"
      order_by:
        - total_revenue desc
      limit: 100

  - name: delivery_performance_analysis
    label: Delivery Performance Analysis
    description: |
      Operational metrics focused on delivery speed and accuracy.
      Tracks on-time delivery rates and average delivery times.
    query_params:
      metrics:
        - delivered_orders
        - on_time_delivery_rate
        - avg_days_to_delivery
        - avg_days_to_approval
        - avg_days_to_carrier
        - avg_delivery_vs_estimate
      group_by:
        - "TimeDimension('metric_time', 'month')"
      where:
        - "{{ Dimension('orders__order_status') }} = 'delivered'"
      order_by:
        - "TimeDimension('metric_time', 'month')"

  - name: customer_satisfaction_trends
    label: Customer Satisfaction Trends
    description: |
      Monthly trends in customer reviews and satisfaction scores.
      Includes positive/negative review breakdowns.
    query_params:
      metrics:
        - review_count
        - average_review_score
        - customer_satisfaction_rate
        - five_star_reviews
        - positive_reviews
        - negative_reviews
      group_by:
        - "TimeDimension('order_reviews__review_creation_date', 'month')"
      order_by:
        - "TimeDimension('order_reviews__review_creation_date', 'month')"

  - name: mom_growth_dashboard
    label: Month-over-Month Growth Dashboard
    description: |
      Key growth metrics comparing current month to prior month.
      Shows revenue growth, order growth, and AOV changes.
    query_params:
      metrics:
        - total_revenue
        - order_count
        - average_order_value
        - revenue_mom_growth
        - orders_mom_growth
        - aov_mom_change
      group_by:
        - "TimeDimension('metric_time', 'month')"
      order_by:
        - "TimeDimension('metric_time', 'month') desc"
      limit: 12

  - name: order_status_funnel
    label: Order Status Funnel
    description: |
      Order volume by status to understand fulfillment funnel.
      Shows progression from purchase through delivery.
    query_params:
      metrics:
        - order_count
        - delivered_orders
        - canceled_orders
        - delivery_rate
        - cancellation_rate
      group_by:
        - "Dimension('orders__order_status')"
      order_by:
        - order_count desc

  - name: cumulative_revenue_tracking
    label: Cumulative Revenue Tracking
    description: |
      Running totals of revenue and orders over time. Useful for
      tracking progress toward annual targets.
    query_params:
      metrics:
        - cumulative_revenue
        - cumulative_orders
        - revenue_mtd
        - revenue_ytd
        - orders_mtd
      group_by:
        - "TimeDimension('metric_time', 'day')"
      order_by:
        - "TimeDimension('metric_time', 'day')"

  - name: marketplace_health_scorecard
    label: Marketplace Health Scorecard
    description: |
      High-level KPIs for overall marketplace health including seller activity,
      product coverage, and customer engagement.
    query_params:
      metrics:
        - total_revenue
        - order_count
        - unique_customers
        - active_sellers
        - seller_activation_rate
        - catalog_coverage_rate
        - customer_satisfaction_rate
        - delivery_rate
      group_by:
        - "TimeDimension('metric_time', 'month')"
      order_by:
        - "TimeDimension('metric_time', 'month') desc"
      limit: 6