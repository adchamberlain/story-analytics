version: 2

saved_queries:
  - name: monthly_revenue_overview
    label: Monthly Revenue Overview
    description: |
      Key revenue and volume metrics aggregated by month for executive reporting.
      Shows GMV, orders, customers, AOV, and month-over-month growth trends.
    query_params:
      metrics:
        - gmv
        - realized_gmv
        - total_revenue
        - freight_revenue
        - orders
        - delivered_orders
        - unique_customers
        - aov
        - items_per_order
        - gmv_mom_growth
        - orders_mom_growth
      group_by:
        - "TimeDimension('metric_time', 'month')"
      where:
        - "{{ Dimension('order__order_status') }} != 'canceled'"
      order_by:
        - "TimeDimension('metric_time', 'month')"
  
  - name: delivery_performance_dashboard
    label: Delivery Performance Dashboard
    description: |
      Critical operational KPIs for delivery performance monitoring.
      Tracks on-time rate, delivery times, and late deliveries by month.
      63% on-time benchmark - late delivery predicts poor reviews.
    query_params:
      metrics:
        - delivered_orders
        - on_time_orders
        - late_orders
        - on_time_delivery_rate
        - late_delivery_rate
        - avg_delivery_days
        - avg_shipping_days
      group_by:
        - "TimeDimension('metric_time', 'month')"
      where:
        - "{{ Dimension('order__order_status') }} = 'delivered'"
      order_by:
        - "TimeDimension('metric_time', 'month')"
  
  - name: customer_satisfaction_analysis
    label: Customer Satisfaction Analysis
    description: |
      Customer review metrics by month showing satisfaction trends.
      Mean score 4.09/5.0, 57.8% give 5 stars, 11.5% give 1 star.
      Strongly correlated with delivery performance.
    query_params:
      metrics:
        - review_count
        - avg_review_score
        - five_star_rate
        - one_star_rate
        - positive_review_rate
        - negative_review_rate
      group_by:
        - "TimeDimension('metric_time', 'month')"
      order_by:
        - "TimeDimension('metric_time', 'month')"
  
  - name: geographic_performance
    label: Geographic Performance by State
    description: |
      Revenue and order metrics by customer state for regional analysis.
      São Paulo (SP) dominates at 42% of customers, followed by RJ (12.9%) and MG (11.7%).
    query_params:
      metrics:
        - gmv
        - orders
        - unique_customers
        - aov
        - avg_review_score
        - on_time_delivery_rate
      group_by:
        - "Dimension('customer__customer_state')"
      where:
        - "{{ Dimension('order__order_status') }} != 'canceled'"
      order_by:
        - gmv desc
      limit: 27
  
  - name: category_performance_ranking
    label: Category Performance Ranking
    description: |
      Product category performance ranked by GMV.
      Top category: bed_bath_table. 73 categories total.
      Always use English translation for readability.
    query_params:
      metrics:
        - gmv
        - orders
        - items_sold
        - aov
        - avg_item_price
        - avg_review_score
      group_by:
        - "Dimension('product__product_category_name_english')"
      where:
        - "{{ Dimension('order__order_status') }} != 'canceled'"
      order_by:
        - gmv desc
      limit: 20
  
  - name: seller_performance_ranking
    label: Seller Performance Ranking
    description: |
      Top sellers ranked by GMV with quality metrics.
      Filter for sellers with minimum 10 orders for statistical significance.
      3,095 sellers total, 59.7% in São Paulo state.
    query_params:
      metrics:
        - gmv
        - orders
        - items_sold
        - avg_review_score
        - on_time_delivery_rate
      group_by:
        - "Dimension('seller__seller_id')"
        - "Dimension('seller__seller_state')"
        - "Dimension('seller__seller_city')"
      where:
        - "{{ Dimension('order__order_status') }} != 'canceled'"
      having:
        - "{{ Metric('orders') }} >= 10"
      order_by:
        - gmv desc
      limit: 100
  
  - name: payment_method_analysis
    label: Payment Method Analysis
    description: |
      Payment method distribution and performance by month.
      Credit card 73.9%, boleto 19%, voucher 5.5%, debit 1.5%.
      50.6% of credit card payments are in 1 installment.
    query_params:
      metrics:
        - total_payment_value
        - credit_card_revenue
        - boleto_revenue
        - voucher_revenue
        - credit_card_share
        - avg_installments
        - orders
      group_by:
        - "TimeDimension('metric_time', 'month')"
      where:
        - "{{ Dimension('order__order_status') }} != 'canceled'"
      order_by:
        - "TimeDimension('metric_time', 'month')"
  
  - name: customer_retention_cohort
    label: Customer Retention Cohort Analysis
    description: |
      Customer acquisition and repeat purchase behavior by cohort month.
      Only ~3% repeat purchase rate - major retention opportunity.
      97% of customers are one-time buyers.
    query_params:
      metrics:
        - unique_customers
        - orders
        - gmv
        - orders_per_customer
        - repeat_purchase_rate
        - revenue_per_customer
      group_by:
        - "TimeDimension('customer__first_order_date', 'month')"
      order_by:
        - "TimeDimension('customer__first_order_date', 'month')"
  
  - name: marketplace_health_metrics
    label: Marketplace Health Metrics
    description: |
      Key marketplace health indicators by month.
      Tracks seller productivity, product diversity, and platform efficiency.
    query_params:
      metrics:
        - gmv
        - orders
        - active_sellers
        - active_products
        - gmv_per_seller
        - items_per_seller
        - orders_per_seller
        - cancellation_rate
      group_by:
        - "TimeDimension('metric_time', 'month')"
      order_by:
        - "TimeDimension('metric_time', 'month')"
  
  - name: freight_cost_analysis
    label: Freight Cost Analysis
    description: |
      Shipping cost analysis by freight bucket and product weight.
      Median freight R$16.26, mean R$19.99.
      Used for logistics optimization and pricing strategy.
    query_params:
      metrics:
        - items_sold
        - freight_revenue
        - gmv
        - avg_freight_value
        - freight_to_price_ratio
      group_by:
        - "Dimension('order_item__freight_bucket')"
        - "Dimension('product__product_weight_bucket')"
      where:
        - "{{ Dimension('order__order_status') }} != 'canceled'"
      order_by:
        - items_sold desc
  
  - name: weekly_operational_snapshot
    label: Weekly Operational Snapshot
    description: |
      Week-over-week operational metrics for short-term monitoring.
      Tracks orders, delivery performance, and satisfaction by week.
    query_params:
      metrics:
        - orders
        - delivered_orders
        - gmv
        - on_time_delivery_rate
        - avg_delivery_days
        - avg_review_score
        - cancellation_rate
      group_by:
        - "TimeDimension('metric_time', 'week')"
      where:
        - "{{ Dimension('order__order_status') }} != 'canceled'"
      order_by:
        - "TimeDimension('metric_time', 'week')"
  
  - name: delivery_satisfaction_correlation
    label: Delivery Performance vs Satisfaction
    description: |
      Correlation analysis between delivery performance and review scores.
      Late delivery strongly predicts poor reviews - critical insight.
      On-time orders have significantly higher review scores.
    query_params:
      metrics:
        - delivered_orders
        - avg_review_score
        - five_star_rate
        - one_star_rate
        - avg_delivery_days
      group_by:
        - "Dimension('order__is_on_time')"
        - "TimeDimension('metric_time', 'month')"
      where:
        - "{{ Dimension('order__order_status') }} = 'delivered'"
      order_by:
        - "TimeDimension('metric_time', 'month')"