# Evidence component reference
# Defines valid components and their props for the LLM

framework: evidence
version: "40.x"

components:
  LineChart:
    description: "Line chart for time series data"
    required_props:
      - data: "Query name reference, e.g., {query_name}"
      - x: "Column name for x-axis"
      - y: "Column name(s) for y-axis"
    optional_props:
      - title: "Chart title"
      - subtitle: "Chart subtitle"
      - y2: "Column name(s) for secondary y-axis (right side)"
      - y2SeriesType: "Chart type for y2 series (line, bar, area)"
    notes:
      - "Single series: y=\"column_name\""
      - "Multiple series: y={[\"column1\", \"column2\"]} (array syntax)"
      - "DUAL Y-AXIS: Use y2 for metrics with different scales (e.g., revenue vs count)"
      - "When y and y2 have different scales, each gets its own axis"
    example_single: |
      <LineChart
        data={query_name}
        x="month"
        y="revenue"
        title="Monthly Revenue"
      />
    example_multi_series: |
      <LineChart
        data={query_name}
        x="month"
        y={["sales_2024", "sales_2025"]}
        title="Sales Comparison"
      />
    example_dual_axis: |
      <LineChart
        data={query_name}
        x="month"
        y="revenue"
        y2="order_count"
        title="Revenue vs Order Volume"
      />

  BarChart:
    description: "Bar chart for categorical comparisons"
    required_props:
      - data: "Query name reference"
      - x: "Column name for x-axis (categories)"
      - y: "Column name for y-axis (values)"
    optional_props:
      - title: "Chart title"
      - subtitle: "Chart subtitle"
      - swapXY: "Set to {true} for HORIZONTAL bars - categories on y-axis, values on x-axis"
    notes:
      - "Default orientation is VERTICAL (categories on x-axis, values on y-axis)"
      - "For HORIZONTAL bars: use swapXY={true}"
      - "Horizontal bars are better when category names are long or when showing rankings"
    example_vertical: |
      <BarChart
        data={query_name}
        x="category"
        y="count"
        title="Count by Category"
      />
    example_horizontal: |
      <BarChart
        data={query_name}
        x="category"
        y="revenue"
        swapXY={true}
        title="Top Customers by Revenue"
      />

  AreaChart:
    description: "Area chart for cumulative data"
    required_props:
      - data: "Query name reference"
      - x: "Column name for x-axis"
      - y: "Column name(s) for y-axis"
    optional_props:
      - title: "Chart title"
    notes:
      - "Same y syntax as LineChart"

  DataTable:
    description: "Interactive data table"
    required_props:
      - data: "Query name reference"
    optional_props:
      - title: "Table title"
    example: |
      <DataTable data={query_name} />

  BigValue:
    description: "Large KPI/metric display"
    required_props:
      - data: "Query name reference"
      - value: "Column name for the value to display"
    optional_props:
      - title: "Label for the metric"
      - fmt: "Format keyword (NOT a format string!)"
    notes:
      - "ALWAYS use fmt prop for proper formatting"
      - "fmt MUST be one of these EXACT keywords (no quotes needed in value):"
      - "  - usd0 = currency, no decimals ($1,234)"
      - "  - usd = currency with decimals ($1,234.56)"
      - "  - num0 = number, no decimals (1,234)"
      - "  - num2 = number, 2 decimals (1,234.56)"
      - "  - pct0 = percentage, no decimals (12%)"
      - "  - pct1 = percentage, 1 decimal (12.3%)"
      - "WRONG: fmt=\"$,.0f\" fmt=\"${:,.0f}\" - these will show 'f' in output!"
      - "RIGHT: fmt=\"usd0\" - this is a keyword, not a format string"
    example: |
      <BigValue data={query_name} value="total_revenue" title="Total Revenue" fmt="usd0" />

  # ===================
  # Filter Components
  # ===================
  # These create input variables accessible via ${inputs.filter_name}
  # Use in SQL queries: WHERE column = '${inputs.filter_name}'

  Dropdown:
    description: "Single-select dropdown filter"
    required_props:
      - name: "Unique filter name - creates ${inputs.name} variable"
      - data: "Query name reference for options"
      - value: "Column name for dropdown values"
    optional_props:
      - title: "Dropdown label"
      - defaultValue: "Default selected value"
    notes:
      - "Creates a variable: ${inputs.name}"
      - "Needs a separate query for options (e.g., SELECT DISTINCT region FROM table)"
      - "Use in WHERE clause: WHERE region = '${inputs.region_filter}'"
    example: |
      ```sql regions
      SELECT DISTINCT region FROM customers ORDER BY region
      ```
      <Dropdown name="region_filter" data={regions} value="region" title="Select Region" />

      ```sql filtered_data
      SELECT * FROM sales WHERE region = '${inputs.region_filter}'
      ```

  DateRange:
    description: "Date range selector with start and end dates"
    required_props:
      - name: "Unique filter name - creates ${inputs.name.start} and ${inputs.name.end}"
    optional_props:
      - title: "Label for the picker"
      - data: "Query name for date range bounds"
      - dates: "Column name containing dates"
      - start: "Manual start date (YYYY-MM-DD)"
      - end: "Manual end date (YYYY-MM-DD)"
      - presetRanges: "Array of preset options like 'Last 7 Days', 'Last 30 Days', 'Year to Date'"
      - defaultValue: "Default preset range selection - MUST be set to avoid defaulting to Jan 1, 1970"
    notes:
      - "Creates TWO variables: ${inputs.name.start} and ${inputs.name.end}"
      - "Use in WHERE: WHERE date >= '${inputs.date_range.start}' AND date <= '${inputs.date_range.end}'"
      - "Preset options: 'Last 7 Days', 'Last 30 Days', 'Last 90 Days', 'Last 3 Months', 'Last 6 Months', 'Last 12 Months', 'Month to Date', 'Year to Date', 'All Time'"
      - "IMPORTANT: Always set defaultValue to a sensible preset (e.g., 'Last 12 Months') to avoid showing Jan 1, 1970 as the default start date"
    example: |
      <DateRange
        name="date_range"
        title="Select Date Range"
        presetRanges={["Last 7 Days", "Last 30 Days", "Last 90 Days", "Last 12 Months", "Year to Date", "All Time"]}
        defaultValue="Last 12 Months"
      />

      ```sql filtered_data
      SELECT * FROM sales
      WHERE sale_date >= '${inputs.date_range.start}'
        AND sale_date <= '${inputs.date_range.end}'
      ```

  TextInput:
    description: "Free text input for search/filtering"
    required_props:
      - name: "Unique filter name - creates ${inputs.name} variable"
    optional_props:
      - title: "Label for the input"
      - placeholder: "Placeholder text"
      - defaultValue: "Default value"
    notes:
      - "Use with LIKE for partial matching: WHERE name LIKE '%${inputs.search}%'"
      - "Or exact matching: WHERE id = '${inputs.search}'"
    example: |
      <TextInput name="search" title="Search" placeholder="Enter customer name..." />

      ```sql filtered_customers
      SELECT * FROM customers WHERE name LIKE '%${inputs.search}%'
      ```

  ButtonGroup:
    description: "Button group for selecting from a few options"
    required_props:
      - name: "Unique filter name - creates ${inputs.name} variable"
      - data: "Query name reference for options"
      - value: "Column name for button values"
    optional_props:
      - title: "Label for the group"
      - defaultValue: "Default selected value"
    notes:
      - "Best for 2-5 options"
      - "More visual than Dropdown for small option sets"
    example: |
      ```sql time_periods
      SELECT 'Last 7 Days' as period UNION ALL
      SELECT 'Last 30 Days' UNION ALL
      SELECT 'Last 90 Days'
      ```
      <ButtonGroup name="period" data={time_periods} value="period" title="Time Period" />

  Slider:
    description: "Numeric slider for range selection"
    required_props:
      - name: "Unique filter name - creates ${inputs.name} variable"
      - min: "Minimum value"
      - max: "Maximum value"
    optional_props:
      - title: "Label for the slider"
      - step: "Step increment (default 1)"
      - defaultValue: "Default value"
    notes:
      - "Good for numeric filtering like price ranges, quantities"
      - "Use in WHERE: WHERE amount >= ${inputs.min_amount}"
    example: |
      <Slider name="min_revenue" min={0} max={100000} step={1000} title="Minimum Revenue" />

      ```sql high_value_customers
      SELECT * FROM customers WHERE total_revenue >= ${inputs.min_revenue}
      ```

# Common mistakes to avoid
common_mistakes:
  - mistake: "Using y2, y3 for multiple series"
    correct: "Use y={[\"col1\", \"col2\"]} array syntax"
  - mistake: "Missing curly braces around data reference"
    correct: "Always use data={query_name}, not data=\"query_name\""
  - mistake: "Using Python/C format strings like '${:,.0f}', '{:.2f}', '$,.0f', etc."
    correct: "NEVER use format strings with 'f' suffix. Use Evidence fmt prop: fmt=\"usd0\" for currency, fmt=\"num2\" for numbers"
  - mistake: "Numbers showing as '$,1290507.0f' with 'f' at the end"
    correct: "This happens when using wrong format strings. Use fmt=\"usd0\" NOT fmt=\"$,.0f\""
  - mistake: "Setting fmt to a Python-style format string"
    correct: "Evidence fmt values are simple keywords: usd, usd0, usd2, num0, num2, pct, pct1, pct2 - NOT format codes"
